UPDATE CXP_OPS_MONITORING.CXP_STORE_SUPPORT_RULE_AYS_NP
SET 
    -- 1. Point to the specific field
    JSON_PATH_VALUE = 'orderDetails{}.portIn',
    
    -- 2. Use the NOT EQUALS operator
    OPERATOR = 'NOT EQUALS',
    
    -- 3. We want to stop if it is NOT 'A'
    EXPECTED_VALUE = 'A',
    
    -- 4. Ensure it stops and sends the template
    RULE_ACTION = 'STOP',
    RULE_TYPE = 'TEMPLATE_RESPONSE',
    RULE_CONTEXT = 'TEMP_PORT_IN_MSG'
WHERE 
    RULE_NAME = 'portin-check';

COMMIT;

elif operator == 'NOT EQUALS':
                # --- NEW LOGIC START ---
                # 1. Safety Check: If the value is missing, None, or False, 
                # strictly ignore it. We treat these as "Not a Port In order".
                val_str = str(actual_value).lower().strip()
                if actual_value is None or val_str in ['false', 'none', '', 'null']:
                    return False
                
                # 2. Logic Check: If we have a real status (e.g. 'Pending', 'S'), 
                # return TRUE only if it does not match the expected value ('A').
                return str(actual_value).lower().strip() != str(expected_value).lower().strip()
                # --- NEW LOGIC END ---
