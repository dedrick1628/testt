def _execute_rule(self, intent_type, rule_type: str, context: Dict[str, Any], rule: Dict[str, Any], prev_rule_id:str,rule_context:str) -> Dict[str, Any]:
        """Execute specific rule type with error propagation fix"""
        
        condition_config = {
                    'json_path_value': rule['JSON_PATH_VALUE'],
                    'operator': rule['operator'],
                    'expected_value': rule['expected_value'],
                    'condition_id': rule['rule_id']
                }
        try:
            # --- API CALL LOGIC ---
            if rule_type == 'API_CALL':
               result = self._execute_api_call_step(intent_type, rule, context)
               
               # üî¥ FIX: Check status. If SUCCESS, proceed with flow.
               if result['status'] == 'SUCCESS':
                  if rule['rule_action'] == 'CONTINUE' and rule['rule_next_step']:
                     next_rule = self._find_rule_by_intent_and_rule_id(intent_type, rule['rule_next_step'])
                     print("Next scenario rule", next_rule)
                     if next_rule:
                        # Recursively execute the next rule
                        return self._execute_rule(intent_type, next_rule['rule_type'], context, next_rule, next_rule['rule_next_step'], next_rule['rule_context'])
                  
                  # If no next step, just return success
                  return result
               
               # üî¥ FIX: If status is ERROR/INFO (Failure), RETURN IMMEDIATELY. 
               # Do not let the code fall through or return None.
               else:
                  print(f"         üõë Stopping flow due to API step status: {result['status']}")
                  return result

            # --- API RESPONSE LOGIC ---
            elif rule_type == 'API_RESPONSE':
                result = self._evaluate_condition(condition_config, context, prev_rule_id, rule['rule_context'], rule)
                
                if result:
                    print(f"         ‚úÖ Condition met for rule: {rule['rule_name']}")
                    next_rule = None
                    if rule['rule_action'] == 'CONTINUE' and rule['rule_next_step']:
                        next_rule = self._find_rule_by_intent_and_rule_id(intent_type, rule['rule_next_step'])
                        print("Next scenario rule", next_rule)
                        if next_rule:
                            return self._execute_rule(intent_type, next_rule['rule_type'], context, next_rule, next_rule['rule_id'], next_rule['rule_context'])
                        else:
                            print(f"‚ùå No rule configured for : {rule['rule_next_step']}")
                            
                elif not result:
                    print(f"         ‚ùå Condition not met for rule: {rule['rule_name']}")
                    next_step = self._find_failure_case_rule(intent_type, rule)
                    next_rule = self._find_rule_by_intent_and_rule_id(intent_type, next_step)

                    if next_rule:
                        result = self._execute_rule(intent_type, next_rule['rule_type'], context, next_rule, next_rule['rule_id'], next_rule['rule_context'])
                        
                        # If failure case returned a template response, store and return it immediately
                        if result and result.get('status') == 'SUCCESS' and 'policy' in result.get('message', '').lower():
                            print(f"         üö® FAILURE CASE RETURNED TEMPLATE - PROPAGATING UP!")
                            self.template_response = result
                            return result
                        return result # Return the result of the failure path
                    else:
                        print(f"‚ùå No rule configured for : {next_step}")

            # --- DB QUERY LOGIC ---
            elif rule_type == 'DB_QUERY':
                result = self._execute_database_query_step(rule, context, rule['rule_id'])
                self._log_execution_step(
                        rule, rule['rule_name'],
                        rule['JSON_PATH_VALUE'],
                        result,
                        None, "INFO", result['status']
                    )
                print("DB_QUERY result ===>", result)
                
                if str(result) == 'True':
                    print(f"         ‚úÖ Condition met for rule query: {rule['rule_name']}")
                    if rule['rule_action'] == 'CONTINUE' and rule['rule_next_step']:
                        next_rule = self._find_rule_by_intent_and_rule_id(intent_type, rule['rule_next_step'])
                        if next_rule:
                            return self._execute_rule(intent_type, next_rule['rule_type'], context, next_rule, next_rule['rule_id'], next_rule['rule_context'])
                            
                elif str(result) == 'False':
                    print(f"         ‚úÖ Condition Not met for rule negative scenario query: {rule['rule_name']}")
                    next_step = self._find_failure_case_rule(intent_type, rule)
                    next_rule = self._find_rule_by_intent_and_rule_id(intent_type, next_step)

                    if next_rule:
                        return self._execute_rule(intent_type, next_rule['rule_type'], context, next_rule, next_rule['rule_id'], next_rule['rule_context'])

            # --- QUERY RESULTS LOGIC ---
            elif rule_type == 'QUERY_RESULTS':
                result = self._evaluate_condition(condition_config, context, prev_rule_id, rule['rule_context'], rule)
                self._log_execution_step(
                        rule, rule['rule_name'],
                        rule['JSON_PATH_VALUE'],
                        result,
                        None, "INFO", result['status']
                    )
                if result == True:
                    print(f"         ‚úÖ Condition met for rule: {rule['rule_name']}")
                    if rule['rule_action'] == 'CONTINUE' and rule['rule_next_step']:
                            next_rule = self._find_rule_by_intent_and_rule_id(intent_type, rule['rule_next_step'])
                            if next_rule:
                                return self._execute_rule(intent_type, next_rule['rule_type'], context, next_rule, next_rule['rule_id'], next_rule['rule_context'])
                                
                elif result == False:
                    print(f"         ‚úÖ Condition met for rule negative scenario: {rule['rule_name']}")
                    next_step = self._find_failure_case_rule(intent_type, rule)
                    next_rule = self._find_rule_by_intent_and_rule_id(intent_type, next_step)

                    if next_rule:
                        return self._execute_rule(intent_type, next_rule['rule_type'], context, next_rule, next_rule['rule_id'], next_rule['rule_context'])

            # --- TEMPLATE RESPONSE LOGIC ---
            elif rule_type == 'TEMPLATE_RESPONSE':
                # Log template response start
                self._log_execution_step(
                    rule, 'TEMPLATE_RESPONSE_START',
                    {'rule_context': rule.get('rule_context', ''), 'context': context},
                    None, None, "INFO", "STARTED"
                )

                result = self._execute_response_template_step(context, rule['rule_context'])
                if result['status'] == 'SUCCESS':
                    print(f"         ‚úÖ Template response generated for rule: {result['message']}")
                    print(f"         üéØ RETURNING TEMPLATE RESPONSE DIRECTLY: {result}")

                    # Log successful template response
                    self._log_execution_step(
                        rule, 'TEMPLATE_RESPONSE_SUCCESS',
                        {'rule_context': rule.get('rule_context', '')},
                        {'message': result['message']},
                        None, "INFO", "SUCCESS"
                    )

                    # Store template response for main method to capture
                    self.template_response = result
                    return result
                else:
                    print(f"         ‚ùå Template response failed: {result}")
                    self._log_execution_step(
                        rule, 'TEMPLATE_RESPONSE_FAILED',
                        {'rule_context': rule.get('rule_context', '')},
                        None,
                        result.get('message', 'Template response failed'),
                        "ERROR", "FAILED"
                    )
                    return result

        except Exception as e:
            return self._create_response("ERROR", f"Step execution error: {str(e)}", rule['rule_id'])
        
        # Default return if no path taken
        return None
