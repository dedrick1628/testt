def _log_execution_step(self, rule_dict: Dict[str, Any], action: str, 
                       input_data: Any = None, output_data: Any = None,
                       error_message: str = None, message_type: str = "INFO",
                       action_status: str = "SUCCESS") -> None:
        """Log execution step to database"""
        try:
            # Prepare data
            rule_id = rule_dict.get('rule_id', '')
            rule_name = rule_dict.get('rule_name', '')
            step_id = rule_dict.get('rule_step_number', '')
            
            # Get existing fields
            intent_type = self.current_context.get('intent_type', rule_dict.get('intent_type', ''))
            mtn_data = self.current_context.get('mtn_list')
            mtn_log_value = str(mtn_data) if mtn_data else ''

            # --- INITIALIZE VARIABLES ---
            channel_id = ''
            activation_status = ''
            source_type_code = ''
            source_type_val = ''

            # --- üîç EXTRACTION DEBUGGING START ---
            print(f"\nüîç --- STARTING DATA EXTRACTION (Rule: {rule_name}) ---")

            # Iterate through all API results in memory
            for key, value in self.current_context.items():
                # Only look at API results keys
                if key.startswith('api_result_') and isinstance(value, dict):
                    print(f"   üìÇ Analyzing Context Key: {key}")
                    data = value.get('response_data', {})
                    
                    if not data: 
                        print("      ‚ö†Ô∏è response_data is empty, skipping.")
                        continue

                    # 1. Look for 'orderDetails'
                    if 'orderDetails' in data and isinstance(data['orderDetails'], dict):
                        details = data['orderDetails']
                        print(f"      ‚úÖ Found 'orderDetails' dictionary.")
                        
                        # Debug raw values found in this specific API result
                        raw_channel = details.get('channel', 'MISSING')
                        raw_status = details.get('activationStatus', 'MISSING')
                        print(f"         -> Raw 'channel' found: '{raw_channel}'")
                        print(f"         -> Raw 'activationStatus' found: '{raw_status}'")

                        # Capture only if not already set (Keep the first valid one we find)
                        if not channel_id and raw_channel != 'MISSING': 
                            channel_id = raw_channel
                            print(f"         üéØ CAPTURED CHANNEL_ID: {channel_id}")
                        
                        if not activation_status and raw_status != 'MISSING': 
                            activation_status = raw_status
                            print(f"         üéØ CAPTURED ACTIVATION_STATUS: {activation_status}")

                    # 2. Look for 'pendingOrders'
                    if 'pendingOrders' in data and isinstance(data['pendingOrders'], list):
                        print(f"      ‚úÖ Found 'pendingOrders' list (Length: {len(data['pendingOrders'])})")
                        
                        if len(data['pendingOrders']) > 0:
                            first_order = data['pendingOrders'][0]
                            
                            # Debug raw values
                            raw_st_code = first_order.get('sourceTypeCode', 'MISSING')
                            raw_st_val = first_order.get('sourceTypeVal', 'MISSING')
                            print(f"         -> Raw 'sourceTypeCode' found: '{raw_st_code}'")
                            print(f"         -> Raw 'sourceTypeVal' found: '{raw_st_val}'")

                            if not source_type_code and raw_st_code != 'MISSING':
                                source_type_code = raw_st_code
                                print(f"         üéØ CAPTURED SOURCE_TYPE_CODE: {source_type_code}")
                                
                            if not source_type_val and raw_st_val != 'MISSING':
                                source_type_val = raw_st_val
                                print(f"         üéØ CAPTURED SOURCE_TYPE_VAL: {source_type_val}")
            
            print("üîç --- DATA EXTRACTION FINISHED ---")

            # --- VERIFICATION DEBUG ---
            print(f"\nüß™ FINAL VALUES TO INSERT:")
            print(f"   CHANNEL_ID:        '{channel_id}'")
            print(f"   ACTIVATION_STATUS: '{activation_status}'")
            print(f"   SOURCE_TYPE_CODE:  '{source_type_code}'")
            print(f"   SOURCE_TYPE_VAL:   '{source_type_val}'")
            print("-" * 30)

            # Generate LOG_ID
            log_id = int(datetime.now().strftime('%Y%m%d%H%M%S%f')[:-3]) + random.randint(1, 999)
            
            # JSON conversion
            input_json = json.dumps(input_data, default=str) if input_data else None
            output_json = json.dumps(output_data, default=str) if output_data else None

            # SQL INSERT
            insert_sql = """
                INSERT INTO CXP_OPS_MONITORING.CXP_STORE_SUPPORT_EXECUTION_LOG_NP (
                    LOG_ID, RULE_ID, SESSION_ID, RULE_NAME, ORDER_NUMBER, 
                    LOCATION_CODE, STEP_ID, STEP_NAME, ACTION, INPUT_DATA, 
                    OUTPUT_DATA, ERROR_MESSAGE, MESSAGE_TYPE, ACTION_STATUS, 
                    INTENT_TYPE, MTN, 
                    CHANNEL_ID, ACTIVATION_STATUS, SOURCE_TYPE_CODE, SOURCE_TYPE_VAL,
                    CREATED_DATE
                ) VALUES (
                    :log_id, :rule_id, :session_id, :rule_name, :order_number,
                    :location_code, :step_id, :step_name, :action, :input_data,
                    :output_data, :error_message, :message_type, :action_status, 
                    :intent_type, :mtn, 
                    :channel_id, :activation_status, :source_type_code, :source_type_val,
                    SYSTIMESTAMP
                )
            """

            self.cursor.execute(insert_sql, {
                'log_id': log_id,
                'rule_id': rule_id,
                'session_id': self.session_id,
                'rule_name': rule_name,
                'order_number': self.current_context.get('order_number', ''),
                'location_code': self.current_context.get('location_code', ''),
                'step_id': str(step_id),
                'step_name': rule_name,
                'action': action,
                'input_data': input_json,
                'output_data': output_json,
                'error_message': error_message,
                'message_type': message_type,
                'action_status': action_status,
                'intent_type': intent_type,
                'mtn': mtn_log_value,
                'channel_id': str(channel_id),
                'activation_status': str(activation_status),
                'source_type_code': str(source_type_code),
                'source_type_val': str(source_type_val)
            })

            self.connection.commit()
            print(f"üìù LOGGED: {action} for {rule_name} (Session: {self.session_id})")

        except Exception as e:
            print(f"‚ùå Logging error: {str(e)}")
            pass
