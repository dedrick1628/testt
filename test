
<form version="1.1" theme="light">
  <label>DS - Starlink Usage Dashboard</label>
  <init>
    <set token="start_time">$field1.earliest$</set>
    <set token="end_time">$field1.latest$</set>
  </init>
  <fieldset submitButton="false">
    <input type="time" token="field1" depends="$test$">
      <label>Global Time Range</label>
      <default>
        <earliest>@y</earliest>
        <latest>now</latest>
        <change>
          <set token="start_time">$field1.earliest$</set>
          <set token="end_time">$field1.latest$</set>
        </change>
      </default>
    </input>
    <input type="dropdown" token="customer">
      <label>Select Customer</label>
      <choice value="Frontline&quot; OR customer.customername=&quot;Satellite Solutions Group&quot; OR customer.customername=&quot;Verizon Wireless">All</choice>
      <fieldForLabel>customer.customername</fieldForLabel>
      <fieldForValue>customer.customername</fieldForValue>
      <search>
        <query>index=sat_leo_ref sourcetype=sat_prov_circuit earliest=@year
| join type=left left=circuit right=location where circuit.location=location.@id
    [search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year
    ]
    | join type=left left=L right=customer where L.location.customer=customer.@id
    [search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year
     ]
| rename L.* as *
| search customer.customername="Frontline" OR customer.customername="Verizon Wireless" OR customer.customername="Satellite Solutions Group"
| table circuit.circuitalias location.sitename location.division customer.customername location.sitetype
| stats count by customer.customername</query>
        <earliest>$field1.earliest$</earliest>
        <latest>$field1.latest$</latest>
      </search>
      <default>Frontline" OR customer.customername="Satellite Solutions Group" OR customer.customername="Verizon Wireless</default>
      <initialValue>Frontline" OR customer.customername="Satellite Solutions Group" OR customer.customername="Verizon Wireless</initialValue>
      <prefix>(customer.customername="</prefix>
      <suffix>")</suffix>
    </input>
    <input type="dropdown" token="sitecode">
      <label>Select Division</label>
      <choice value="*">All</choice>
      <default>*</default>
      <initialValue>*</initialValue>
      <fieldForLabel>location.sitename</fieldForLabel>
      <fieldForValue>location.sitename</fieldForValue>
      <search>
        <query>index=sat_leo_ref sourcetype=sat_prov_circuit
| join type=left left=circuit right=location where circuit.location=location.@id
    [search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year
    ]
    | join type=left left=L right=customer where L.location.customer=customer.@id
    [search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year
     ]
| rename L.* as *
| search $customer$
| table circuit.circuitalias location.sitename location.division customer.customername location.sitetype
| stats count by location.sitename</query>
        <earliest>$field1.earliest$</earliest>
        <latest>$field1.latest$</latest>
      </search>
    </input>
  </fieldset>
  <row depends="$hidden$">
    <panel>
      <table>
        <search>
          <done>
            <set token="tkn_display_earliest">$result.earliest$</set>
            <set token="tkn_display_latest">$result.latest$</set>
          </done>
          <query>| stats count 
| addinfo
| eval earliest = strftime(info_min_time,"%b %d %Y %H:%M:%S")
| eval info_max_time = if(info_max_time="+Infinity",now(),info_max_time)
| eval latest = strftime(info_max_time,"%b %d %Y %H:%M:%S")</query>
          <earliest>$field1.earliest$</earliest>
          <latest>$field1.latest$</latest>
        </search>
        <option name="count">10</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h4>TimeRange="$tkn_display_earliest$" to "$tkn_display_latest$" for $customer$ and Sitecode="$sitecode$"</h4>
      </html>
    </panel>
  </row>
  <row>
    <panel>
      <title>Usage by Month</title>
      <chart>
        <search>
          <query>index=sat_leo_starlink_np"billingCycles.dailyDataUsage.date"="*" earliest=@year
| spath output=UsageDate path=billingCycles.dailyDataUsage.date 
| spath output=EndDate path=billingCycles.endDate
| eval UsageDate=strptime(UsageDate,"%Y-%m-%d")
| eval UsageDate=strftime(UsageDate,"%Y-%m-%d")
| eval startDate="2025-01-01"
| eval stopDate = strftime(ceiling(relative_time(now(), "+1mon")/86400)*86400, "%Y-%m-%d")
| eval stopDate=relative_time(stopDate,"+1Mon@mon")
| eval stopDate=strftime(stopDate,"%F")
| where UsageDate&gt;=startDate
| eval Month=strftime(UsageDate, "@mon")
| stats max(billingCycles.totalPriorityGB) as "Total Priority GBytes" by serviceLineNumber EndDate
| dedup serviceLineNumber EndDate
| join type=left serviceLineNumber 
    [| search index="sat_leo_starlink_prod" sourcetype=device_servicelines "data.active"=true 
    | spath output="serviceLineNumber" path=data.serviceLineNumber 
    | spath output="CircuitID" path=data.nickname 
    | spath output=StartDate path=data.startDate 
    | spath output=PublicIP path=data.publicIp 
    | eval StartDate=strftime(strptime(StartDate,"%F"),"%F")] 
| join type=left left=starlink right=circuit where starlink.CircuitID=circuit.circuitalias 
    [ search index=sat_leo_ref sourcetype=sat_prov_circuit earliest=@year] 
| join type=left left=LL right=location where LL.circuit.location=location.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year] 
| join type=left left=LLL right=customer where LLL.location.customer=customer.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year] 
| search $customer$ LLL.location.sitename="$sitecode$" 
| rename LLL.LL.starlink.* as *
| stats sum("Total Priority GBytes") as "Total GBytes" by EndDate
| eval EndDate=strptime(EndDate,"%Y-%m-%dT%H:%M:%S")
| eval EndDate=strftime(EndDate-1, "%Y-%m")
| rename EndDate as "End Date"
| addcoltotals "Total GBytes" labelfield="End Date" label=Total</query>
          <earliest>@y</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">all</option>
        <drilldown>
          <set token="tkn_month">$click.value$</set>
          <eval token="start_time">strptime($tkn_month$."-01", "%Y-%m-%d")</eval>
          <eval token="end_time">relative_time($start_time$, "+1mon@mon")</eval>
        </drilldown>
      </chart>
    </panel>
    <panel>
      <title>Top 10 Circuit Usage Today</title>
      <chart>
        <search>
          <query>index=sat_leo_starlink_prod "billingCycles.dailyDataUsage.date"="*" 
| spath output=UsageDate path=billingCycles.dailyDataUsage.date ```Get the Billing Cycle date from the json path``` 
| eval UsageDate=strptime(UsageDate,"%Y-%m-%d") 
| eval UsageDate=strftime(UsageDate,"%Y-%m-%d") 
| where UsageDate=strftime(now(),"%F") 
| stats max(billingCycles.dailyDataUsage.priorityGB) as priorityGB by UsageDate serviceLineNumber 
    ``` 
| stats sum(priorityGB) by serviceLineNumber UsageDate``` 
| join type=left left=L Right=R where L.serviceLineNumber=R.data.serviceLineNumber 
    [ search index="sat_leo_starlink_np" sourcetype=device_servicelines "data.active"=true earliest=@year
    | spath output="Service Line" path=data.serviceLineNumber 
    | spath output="CircuitID" path=data.nickname 
    | spath output=StartDate path=data.startDate 
    | spath output=PublicIP path=data.publicIp 
    | eval StartDate=strftime(strptime(StartDate,"%F"),"%F")
        ] 
| join type=left left=starlink right=circuit where starlink.R.CircuitID=circuit.circuitalias 
    [ search index=sat_leo_ref sourcetype=sat_prov_circuit earliest=@year] 
| join type=left left=LL right=location where LL.circuit.location=location.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year] 
| join type=left left=LLL right=customer where LLL.location.customer=customer.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year] 
| search $customer$ LLL.location.sitename="$sitecode$" 
| rename LLL.LL.starlink.L.* as *
| rename LLL.LL.starlink.R.CircuitID as "Circuit ID"| where isnotnull('Circuit ID')
| rename priorityGB as "Priority GBytes" 
| rename UsageData as "Usage Date" 
| sort -"Priority GBytes" 
| head 10 
| table "Circuit ID" "Priority GBytes"</query>
          <earliest>@d</earliest>
          <latest>now</latest>
        </search>
        <option name="charting.axisY.scale">log</option>
        <option name="charting.chart">bar</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Selected TimeRange Total</title>
      <single>
        <search>
          <query>index=sat_leo_starlink_np"billingCycles.dailyDataUsage.date"="*" 
| spath output=UsageDate path=billingCycles.dailyDataUsage.date 
| spath output=EndDate path=billingCycles.endDate
| eval UsageDate=strptime(UsageDate,"%Y-%m-%dT%H:%M:%SZ")
| addinfo
| eval info_max_time = if(info_max_time="+Infinity",now(),info_max_time)
| where UsageDate &gt;= info_min_time AND UsageDate &lt;= info_max_time 
| stats max(billingCycles.totalPriorityGB) as "Total Priority GBytes" by serviceLineNumber EndDate
| dedup serviceLineNumber EndDate
| join type=left serviceLineNumber 
    [| search index="sat_leo_starlink_prod" sourcetype=device_servicelines "data.active"=true earliest=@year
    | spath output="serviceLineNumber" path=data.serviceLineNumber 
    | spath output="CircuitID" path=data.nickname 
    | spath output=StartDate path=data.startDate 
    | spath output=PublicIP path=data.publicIp 
    | eval StartDate=strftime(strptime(StartDate,"%F"),"%F")] 
| join type=left left=starlink right=circuit where starlink.CircuitID=circuit.circuitalias 
    [ search index=sat_leo_ref sourcetype=sat_prov_circuit earliest=@year] 
| join type=left left=LL right=location where LL.circuit.location=location.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year] 
| join type=left left=LLL right=customer where LLL.location.customer=customer.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year] 
| search $customer$ LLL.location.sitename="$sitecode$" 
| stats sum("LLL.LL.starlink.Total Priority GBytes") by LLL.LL.starlink.EndDate 
| stats sum(sum("LLL.LL.starlink.Total Priority GBytes")) as "TotalUsage" 
| eval "Total Usage"=tostring(TotalUsage,"commas")." GBytes"</query>
          <earliest>$start_time$</earliest>
          <latest>$end_time$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="refresh.display">progressbar</option>
        <option name="unit">GB</option>
      </single>
    </panel>
    <panel>
      <title>Data Usage Prediction Date</title>
      <single>
        <search>
          <query>index=sat_leo_starlink_prod "billingCycles.dailyDataUsage.date"="*" earliest=@year
| spath output=UsageDate path=billingCycles.dailyDataUsage.date
| eval UsageDate=strptime(UsageDate,"%Y-%m-%dT%H:%M:%SZ")
| addinfo
| eval info_max_time = if(info_max_time="+Infinity",now(),info_max_time)
| where UsageDate &gt;= info_min_time AND UsageDate &lt;= info_max_time 
| stats max(billingCycles.dailyDataUsage.priorityGB) as priorityGB by serviceLineNumber _time
| join type=left serviceLineNumber 
    [| search index="sat_leo_starlink_prod" sourcetype=device_servicelines "data.active"=true earliest=@year
    | spath output="serviceLineNumber" path=data.serviceLineNumber 
    | spath output="CircuitID" path=data.nickname 
    | spath output=StartDate path=data.startDate 
    | spath output=PublicIP path=data.publicIp 
    | eval StartDate=strftime(strptime(StartDate,"%F"),"%F")] 
| join type=left left=starlink right=circuit where starlink.CircuitID=circuit.circuitalias 
    [ search index=sat_leo_ref sourcetype=sat_prov_circuit earliest=@year] 
| join type=left left=LL right=location where LL.circuit.location=location.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year] 
| join type=left left=LLL right=customer where LLL.location.customer=customer.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year] 
| search $customer$ LLL.location.sitename="$sitecode$" 
| stats sum("LLL.LL.starlink.priorityGB") as PriorityGBytes by _time
| predict "PriorityGBytes" as prediction algorithm=LLP5 holdback=10 future_timespan=365 period=7 upper95=upper95 lower95=lower95
| eval combined_gbytes = if(isnull(PriorityGBytes),'prediction', PriorityGBytes)
| streamstats sum(combined_gbytes) as "cumulative_gbytes"
| eval threshold_exceeded = if(cumulative_gbytes &gt; 1500000, 1, 0)
| where threshold_exceeded = 1 OR _time&gt;=strptime("2025-12-31", "%Y-%m-%d")
| eval forecast_gbytes=if(threshold_exceeded=1,min(cumulative_gbytes),cumulative_gbytes)
| eval test=strftime(_time,"%F")
| eval forecast_gbytes=tostring(forecast_gbytes,"commas")." GBytes"
| stats earliest(test), earliest(forecast_gbytes),</query>
          <earliest>@y</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </single>
    </panel>
    <panel>
      <title>Data Usage Prediction</title>
      <single>
        <search>
          <query>index=sat_leo_starlink_prod "billingCycles.dailyDataUsage.date"="*" earliest=@year
| spath output=UsageDate path=billingCycles.dailyDataUsage.date
| eval UsageDate=strptime(UsageDate,"%Y-%m-%dT%H:%M:%SZ")
| addinfo
| eval info_max_time = if(info_max_time="+Infinity",now(),info_max_time)
| where UsageDate &gt;= info_min_time AND UsageDate &lt;= info_max_time 
| stats max(billingCycles.dailyDataUsage.priorityGB) as priorityGB by serviceLineNumber _time
| join type=left serviceLineNumber 
    [| search index="sat_leo_starlink_prod" sourcetype=device_servicelines "data.active"=true earliest=@year
    | spath output="serviceLineNumber" path=data.serviceLineNumber 
    | spath output="CircuitID" path=data.nickname 
    | spath output=StartDate path=data.startDate 
    | spath output=PublicIP path=data.publicIp 
    | eval StartDate=strftime(strptime(StartDate,"%F"),"%F")] 
| join type=left left=starlink right=circuit where starlink.CircuitID=circuit.circuitalias 
    [ search index=sat_leo_ref sourcetype=sat_prov_circuit earliest=@year] 
| join type=left left=LL right=location where LL.circuit.location=location.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year] 
| join type=left left=LLL right=customer where LLL.location.customer=customer.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year] 
| search $customer$ LLL.location.sitename="$sitecode$" 
| stats sum("LLL.LL.starlink.priorityGB") as PriorityGBytes by _time
| predict "PriorityGBytes" as prediction algorithm=LLP5 holdback=10 future_timespan=365 period=7 upper95=upper95 lower95=lower95
| eval combined_gbytes = if(isnull(PriorityGBytes),'prediction', PriorityGBytes)
| streamstats sum(combined_gbytes) as "cumulative_gbytes"
| eval threshold_exceeded = if(cumulative_gbytes &gt; 1500000, 1, 0)
| where threshold_exceeded = 1 OR _time&gt;=strptime("2025-12-31", "%Y-%m-%d")
| eval forecast_gbytes=if(threshold_exceeded=1,min(cumulative_gbytes),cumulative_gbytes)
| eval test=strftime(_time,"%F")
| eval forecast_gbytes=tostring(forecast_gbytes,"commas")." GBytes"
| stats earliest(forecast_gbytes), earliest(test)</query>
          <earliest>@y</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Terminal Count</title>
      <single>
        <search>
          <query>index=sat_leo_ref sourcetype=sat_prov_circuit
| join type=left left=circuit right=location where circuit.location=location.@id
    [search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year
    ]
    | join type=left left=L right=customer where L.location.customer=customer.@id
    [search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year
     ]
| rename L.* as *
| search $customer$
| table circuit.circuitalias location.sitename location.division customer.customername location.sitetype
| stats count by location.sitename
| stats count</query>
          <earliest>$start_time$</earliest>
          <latest>$end_time$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </single>
    </panel>
    <panel>
      <title>Service Line Count</title>
      <single>
        <search>
          <query>index=sat_leo_starlink_np sourcetype="device_terminals" 
      | spath path=data{}.userTerminalId output=userterminal
      | spath path=data{}.nickname output=nickname
      | spath path=data{}.kitSerialNumber output=kitserialnumber
      | spath path=data{}.dishSerialNumber output=dishserialnumber
      | spath path=data{}.serviceLineNumber output=serviceLineNumber
      | spath path=data{}.active output=terminal_active
| where serviceLineNumber!="null"
| where terminal_active="true"
| join type=left serviceLineNumber 
    [| search index="sat_leo_starlink_prod" sourcetype=device_servicelines "data.active"=true 
    | spath output="serviceLineNumber" path=data.serviceLineNumber 
    | spath output="CircuitID" path=data.nickname 
    | spath output=StartDate path=data.startDate 
    | spath output=PublicIP path=data.publicIp 
    | eval StartDate=strftime(strptime(StartDate,"%F"),"%F")] 
| join type=left left=starlink right=circuit where starlink.CircuitID=circuit.circuitalias 
    [ search index=sat_leo_ref sourcetype=sat_prov_circuit earliest=@year] 
| join type=left left=LL right=location where LL.circuit.location=location.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year] 
| join type=left left=LLL right=customer where LLL.location.customer=customer.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year] 
| search $customer$ LLL.location.sitename="$sitecode$" 
| dedup LLL.LL.starlink.userterminal
| stats``` count("LLL.LL.starlink.userterminal"), ```distinct_count("LLL.LL.starlink.data.serviceLineNumber")</query>
          <earliest>$start_time$</earliest>
          <latest>$end_time$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Top 10 Circuits by Usage</title>
      <chart>
        <search>
          <query>index=sat_leo_starlink_prod "billingCycles.dailyDataUsage.date"="*" earliest=@year
| spath output=UsageDate path=billingCycles.dailyDataUsage.date ```Get the Billing Cycle date from the json path```
| spath output=totalPriorityGBytes path=billingCycles.totalPriorityGB
| eval UsageDate=strptime(UsageDate,"%Y-%m-%d")
| eval UsageDate=strftime(UsageDate,"%Y-%m-%d")
| eval startDate="2025-01-01"
| eval stopDate=strptime(startDate,"%F")
| eval stopDate=relative_time(stopDate,"+12Mon@mon")
| eval stopDate=strftime(stopDate,"%F")
| eval stopDate=if(startDate="2024-12-31",stopDate="2025-12-31",stopDate)
| where UsageDate&gt;=startDate and UsageDate&lt;stopDate
| stats max(totalPriorityGBytes) as priorityGB by serviceLineNumber
| join type=left left=L Right=R where L.serviceLineNumber=R.data.serviceLineNumber
      [search index="sat_leo_starlink_np" sourcetype=device_servicelines  "data.active"=true 
| spath output="Service Line" path=data.serviceLineNumber
| spath output="CircuitID" path=data.nickname
| spath output=StartDate path=data.startDate
| spath output=PublicIP path=data.publicIp
| eval StartDate=strftime(strptime(StartDate,"%F"),"%F")
]
| join type=left left=starlink right=circuit where starlink.R.CircuitID=circuit.circuitalias 
    [ search index=sat_leo_ref sourcetype=sat_prov_circuit earliest=@year] 
| join type=left left=LL right=location where LL.circuit.location=location.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year] 
| join type=left left=LLL right=customer where LLL.location.customer=customer.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year] 
| search $customer$ LLL.location.sitename="$sitecode$" 
| rename LLL.LL.starlink.L.* as *
| sort - priorityGB
| rename LLL.LL.starlink.R.CircuitID as "Circuit ID"
| rename priorityGB as "Priority GBytes"
| where isnotnull('Circuit ID')
| head 10
| table "Circuit ID" "Priority GBytes"</query>
          <earliest>$start_time$</earliest>
          <latest>$end_time$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisY.scale">log</option>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Usage by Day</title>
      <chart>
        <search>
          <query>index=sat_leo_starlink_prod "billingCycles.dailyDataUsage.date"="*"
| spath output=UsageDate path=billingCycles.dailyDataUsage.date ```Get the Billing Cycle date from the json path```
| eval UsageDate=strptime(UsageDate,"%Y-%m-%d")
| stats max(billingCycles.dailyDataUsage.priorityGB) as priorityGB by serviceLineNumber UsageDate
| join type=left serviceLineNumber 
    [| search index="sat_leo_starlink_prod" sourcetype=device_servicelines "data.active"=true 
    | spath output="serviceLineNumber" path=data.serviceLineNumber 
    | spath output="CircuitID" path=data.nickname 
    | spath output=StartDate path=data.startDate 
    | spath output=PublicIP path=data.publicIp 
    | eval StartDate=strftime(strptime(StartDate,"%F"),"%F")] 
| join type=left left=starlink right=circuit where starlink.CircuitID=circuit.circuitalias 
    [ search index=sat_leo_ref sourcetype=sat_prov_circuit earliest=@year] 
| join type=left left=LL right=location where LL.circuit.location=location.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year] 
| join type=left left=LLL right=customer where LLL.location.customer=customer.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year] 
| search $customer$ LLL.location.sitename="$sitecode$" 
| rename LLL.LL.starlink.* as *
| stats sum(priorityGB) as "Priority GBytes" by UsageDate
| eval UsageDate=strftime(UsageDate,"%Y-%m-%d")</query>
          <earliest>$start_time$</earliest>
          <latest>$end_time$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Terminal Count Per Day</title>
      <chart>
        <search>
          <query>index=sat_leo_starlink_prod "billingCycles.dailyDataUsage.date"="*" billingCycles.dailyDataUsage.priorityGB &gt; 0
| spath output=UsageDate path=billingCycles.dailyDataUsage.date 
| eval UsageDate=strptime(UsageDate,"%Y-%m-%d")
| stats max(billingCycles.dailyDataUsage.priorityGB) as priorityGB by UsageDate serviceLineNumber 
| join type=left serviceLineNumber 
    [| search index="sat_leo_starlink_prod" sourcetype=device_servicelines "data.active"=true 
    | spath output="serviceLineNumber" path=data.serviceLineNumber 
    | spath output="CircuitID" path=data.nickname 
    | spath output=StartDate path=data.startDate 
    | spath output=PublicIP path=data.publicIp 
    | eval StartDate=strftime(strptime(StartDate,"%F"),"%F")] 
| join type=left left=starlink right=circuit where starlink.CircuitID=circuit.circuitalias 
    [ search index=sat_leo_ref sourcetype=sat_prov_circuit earliest=@year] 
| join type=left left=LL right=location where LL.circuit.location=location.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year] 
| join type=left left=LLL right=customer where LLL.location.customer=customer.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year] 
| search $customer$ LLL.location.sitename="$sitecode$" 
| rename LLL.LL.starlink.* as *
| stats count(serviceLineNumber) as Count by UsageDate
| eval UsageDate=strftime(UsageDate,"%Y-%m-%d")</query>
          <earliest>$start_time$</earliest>
          <latest>$end_time$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Usage by Customer</title>
      <chart>
        <search>
          <query>index=sat_leo_starlink_prod "billingCycles.dailyDataUsage.date"="*"
| spath output=UsageDate path=billingCycles.dailyDataUsage.date ```Get the Billing Cycle date from the json path```
| eval UsageDate=strptime(UsageDate,"%Y-%m-%d")
| stats max(billingCycles.dailyDataUsage.priorityGB) as priorityGB by serviceLineNumber UsageDate
| join type=left serviceLineNumber 
    [| search index="sat_leo_starlink_prod" sourcetype=device_servicelines "data.active"=true 
    | spath output="serviceLineNumber" path=data.serviceLineNumber 
    | spath output="CircuitID" path=data.nickname 
    | spath output=StartDate path=data.startDate 
    | spath output=PublicIP path=data.publicIp 
    | eval StartDate=strftime(strptime(StartDate,"%F"),"%F")] 
| join type=left left=starlink right=circuit where starlink.CircuitID=circuit.circuitalias 
    [ search index=sat_leo_ref sourcetype=sat_prov_circuit earliest=@year] 
| join type=left left=LL right=location where LL.circuit.location=location.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_location earliest=@year] 
| join type=left left=LLL right=customer where LLL.location.customer=customer.@id 
    [ search index=sat_leo_ref sourcetype=sat_prov_customer earliest=@year] 
| search $customer$ LLL.location.sitename="$sitecode$" 
| rename LLL.LL.starlink.* as *
| stats sum(priorityGB) as "Priority GBytes" by customer.customername
| eval UsageDate=strftime(UsageDate,"%Y-%m-%d")</query>
          <earliest>$start_time$</earliest>
          <latest>$end_time$</latest>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
</form>
